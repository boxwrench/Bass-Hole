# Development Log

This file tracks development sessions, decisions, and context for continuity across sessions and devices. Claude (or any AI assistant) should read this first when picking up the project.

---

## Project Status

**Current State:** v0.2.0 - Core gameplay functional, sprite integration in progress
**Primary Goal:** Idle fishing game for ESP32 CYD (Cheap Yellow Display)
**Related Project:** [DIST_ESP32-CYD-Tester](../DIST_ESP32-CYD-Tester) - Hardware config tool (use this to get CYD settings)

---

## Quick Context for New Sessions

```
This repo: ESP32 fishing idle game "Bass Hole"
Hardware: ESP32 CYD 2.4" (TZT variant, ILI9341 + XPT2046)
Tech stack: PlatformIO, TFT_eSPI, XPT2046_Touchscreen
Key issue being solved: Display color handling (sprites vs primitives)
```

**Critical Hardware Findings:**
- USB count determines driver: single=ILI9341, dual=ST7789
- TFT_BGR color order required for correct colors
- Touch uses SEPARATE SPI pins (25, 32, 33, 36, 39) - not display pins
- Touch rotation is INDEPENDENT from display rotation
- Sprites and primitives behave differently with invertDisplay()

---

## Session Log

### 2026-01-15 - Pivot to Hardware-First Approach

**What was done:**
- Decided to pivot development strategy
- Enhanced DIST_ESP32-CYD-Tester to be comprehensive hardware validation tool
- Goal: Solve all hardware config issues in CYD-Tester, then use those settings here
- Created DEVLOG.md for session continuity

**Key decisions:**
- Hardware testing/research now happens in DIST_ESP32-CYD-Tester repo
- BassHole will focus on game logic, can use emulation for development
- CYD_Config.h generated by tester will be imported here

**Next steps for BassHole:**
- Set up emulation layer (SDL/SFML mock of TFT functions)
- Import working CYD_Config.h after hardware testing
- Continue Phase 2 sprite work

**Blocking issues:**
- Sprite colors washed out/inverted - need to run CYD-Tester color test to determine correct invertDisplay() setting

---

### 2026-01-14 - Phase 2 Sprite Integration

**What was done:**
- Integrated sprite rendering for fish
- Discovered sprite vs primitive color conflict
- Documented findings in docs/PHASE2_FINDINGS.md

**Key findings:**
- With invertDisplay(false): Sprites correct, UI wrong
- With invertDisplay(true): UI correct, sprites may need adjustment
- Solution: Use invertDisplay(true) + normal RGB565 values
- Touch Y-axis is inverted on TZT hardware

**Files changed:**
- graphics.cpp - sprite rendering, display config
- touch.cpp - calibration values
- config.h - color constants
- docs/PHASE2_FINDINGS.md - comprehensive findings

---

### Earlier Sessions

See CHANGELOG.md for version history:
- 0.1.0 - Initial structure
- 0.1.1 - Hardware debugging (backlight, BGR)
- 0.1.2 - Touch calibration fix
- 0.1.3 - Phase 1 finalization (Buy Fish button)
- 0.2.0 - PlatformIO migration

---

## Architecture Notes

```
Game Loop:
1. Update fish AI (hunger, movement, growth)
2. Check for coin drops
3. Handle touch input (feed, collect coins, buy fish)
4. Render frame (background, fish, UI, coins)
5. Auto-save periodically

File Structure:
src/main.cpp      - Entry point, game loop
src/fish.cpp      - Fish AI and behavior
src/touch.cpp     - Touch handling
src/graphics.cpp  - All rendering
src/save.cpp      - SD card persistence
include/config.h  - Game constants, colors
include/sprites/  - Sprite data (RGB565 arrays)
```

## Hardware Config (TZT ESP32 CYD 2.4")

```cpp
// Display
tft.setRotation(0);       // Portrait, USB at bottom
tft.invertDisplay(true);  // Determined by color test

// Touch
touch.setRotation(1);     // Different from display!
#define TOUCH_MIN_X  600
#define TOUCH_MAX_X  3600
#define TOUCH_MIN_Y  500
#define TOUCH_MAX_Y  3600

// Mapping (Y inverted)
mappedX = map(p.x, TOUCH_MAX_X, TOUCH_MIN_X, 0, SCREEN_WIDTH);
mappedY = map(p.y, TOUCH_MIN_Y, TOUCH_MAX_Y, 0, SCREEN_HEIGHT);
```

## Known Issues / Tech Debt

- [ ] Sprite color handling needs verification after CYD-Tester run
- [ ] No emulation layer yet - can't develop without hardware
- [ ] Phase 2 sprites only partially converted
- [ ] No sound implementation yet

## Phase Roadmap

1. **Phase 1: Core Gameplay** - DONE
2. **Phase 2: Art & Character** - IN PROGRESS (sprites, Ty Knotts)
3. **Phase 3: Enemies** - TODO (Clanker, Cogsucker)
4. **Phase 4: Bosses** - TODO (Cyberstuck, CatGPT, etc.)
5. **Phase 5: Polish** - TODO (particles, sound, achievements)

## Reference Docs

- `docs/ESP32_CYD_REFERENCE.md` - Hardware reference
- `docs/HARDWARE.md` - Pinouts, variants
- `docs/PHASE2_FINDINGS.md` - Sprite integration findings
- `docs/CYD_VARIANTS.md` - Board-specific configs
