# Technology Stack

> Generated by /map on 2026-01-19

## Runtime Environment

| Technology | Version | Purpose |
|------------|---------|---------|
| ESP32-WROOM-32 | N/A (MCU) | Main microcontroller (Xtensa dual-core @ 240MHz) |
| Arduino Framework | Via ESP32 platform | Simplified embedded development API |
| PlatformIO | Core | Build system and dependency management |
| Espressif32 Platform | 6.5.0 | ESP32 Arduino core and toolchain |

## Hardware Specifications

| Component | Model | Interface | Purpose |
|-----------|-------|-----------|---------|
| Display | ILI9341 | SPI (HSPI) | 240x320 TFT LCD (262K colors, RGB565) |
| Touch | XPT2046 | SPI (shared) | Resistive touchscreen |
| Storage | MicroSD | SPI (shared) | Game saves + sprite assets |
| Board | ESP32 CYD 2.4" | N/A | Integrated dev board (TZT/Sunton) |

**SPI Pin Configuration:**
- MISO: GPIO 12
- MOSI: GPIO 13
- SCLK: GPIO 14
- Display CS: GPIO 15
- Display DC: GPIO 2
- Touch CS: GPIO 33
- Backlight: GPIO 21

## Production Dependencies

### Arduino Libraries (PlatformIO)

| Package | Version | Purpose | License |
|---------|---------|---------|---------|
| TFT_eSPI | ^2.5.43 | Display rendering (ILI9341 driver) | FreeBSD/MIT |
| XPT2046_Touchscreen | Git (PaulStoffregen) | Touch input handling | MIT |
| SD (Arduino built-in) | N/A | SD card file operations | LGPL |

### Managed Components (ESP-IDF)

Located in `managed_components/`, these are ESP-IDF specific dependencies:

| Component | Purpose | Notes |
|-----------|---------|-------|
| espressif__esp_modem | Modem support | Unused in current build |
| espressif__esp-zboss-lib | Zigbee protocol stack | Unused in current build |
| espressif__esp-zigbee-lib | Zigbee library | Unused in current build |
| joltwallet__littlefs | LittleFS filesystem | Unused in current build |

**Note:** The `managed_components` directory contains 2440 files but most are unused ESP-IDF dependencies. Future cleanup recommended.

## Development Dependencies

### Python Tools (Asset Pipeline)

| Package | Version | Purpose |
|---------|---------|---------|
| Pillow | >=9.0.0 | Image processing (PNG manipulation) |
| NumPy | >=1.20.0 | Array operations for dithering |

**Install:** `pip install -r tools/requirements.txt`

### Development Tools

| Tool | Purpose | Configuration File |
|------|---------|-------------------|
| PlatformIO | Build, upload, monitor | `platformio.ini` |
| VS Code | IDE (recommended) | `.vscode/` settings |
| Cursor | AI-assisted IDE (primary dev) | N/A |
| Git | Version control | `.gitignore` |

## Build Configuration

### PlatformIO Settings (`platformio.ini`)

```ini
[env:esp32-cyd]
platform = espressif32@6.5.0
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 115200
```

### Critical Build Flags

| Flag | Value | Purpose |
|------|-------|---------|
| `USER_SETUP_LOADED` | 1 | Use custom TFT_eSPI config |
| `ILI9341_DRIVER` | 1 | Enable ILI9341 display driver |
| `TFT_RGB_ORDER` | 1 | BGR color order (critical for correct colors) |
| `USE_HSPI_PORT` | 1 | Use HSPI instead of VSPI |
| `SPI_FREQUENCY` | 40MHz | Display SPI speed |
| `SPI_TOUCH_FREQUENCY` | 2.5MHz | Touch SPI speed (slower for stability) |
| `SMOOTH_FONT` | 1 | Anti-aliased font rendering |

**Full build flags:** See `platformio.ini` lines 14-39

## Infrastructure

| Service | Provider | Purpose | Status |
|---------|----------|---------|--------|
| GitHub | GitHub.com | Source code repository | Active |
| Wokwi | wokwi.com | ESP32 hardware simulator | Configured |
| N/A | N/A | No cloud services used | N/A |

**Repository:** [github.com/boxwrench/Bass-Hole](https://github.com/boxwrench/Bass-Hole)

## Configuration Files

### Project Configuration

| File | Purpose | Required |
|------|---------|----------|
| `platformio.ini` | PlatformIO project config | âœ… Yes |
| `wokwi.toml` | Wokwi simulator settings | No (optional) |
| `diagram.json` | Wokwi hardware diagram | No (optional) |
| `include/config.h` | Game constants + pin definitions | âœ… Yes |
| `include/User_Setup.h` | TFT_eSPI display config | âœ… Yes |

### Asset Configuration

| File | Purpose | Required |
|------|---------|----------|
| `tools/requirements.txt` | Python dependencies for asset tools | No (dev only) |
| `sdcard/` directory | Runtime assets (sprites, saves) | No (graceful degradation) |

### Development Configuration

| File | Purpose | Required |
|------|---------|----------|
| `.vscode/settings.json` | VS Code workspace settings | No |
| `.gitignore` | Git exclusion patterns | No |
| `.markdownlint.json` | Markdown linting rules | No |

## Environment Variables

**None required.** All configuration is compile-time via `config.h` and build flags.

## Deployment Targets

| Target | Description | Upload Method |
|--------|-------------|---------------|
| ESP32 CYD 2.4" (TZT) | Primary hardware (verified) | USB Serial (115200 baud) |
| ESP32 CYD 2.4" (Sunton) | Alternative vendor (untested) | USB Serial |
| Wokwi Simulator | Cloud-based emulation | Wokwi CLI / web interface |

## Known Version Issues

### Working Configurations
âœ… **TFT_eSPI 2.5.43** + **Espressif32 6.5.0** + **Arduino Framework** = Verified on hardware

### Potential Conflicts
âš ï¸ **ESP-IDF Components:** The `managed_components/` directory contains ESP-IDF libraries not used in Arduino builds. Potential for future conflicts if migrating to native ESP-IDF.

### Outdated Packages
- ðŸ” **Recommendation:** Run `pio pkg outdated` to check for library updates
- ðŸ“Œ **Pin Versions:** Current versions are verified on hardware; test before upgrading

## Memory Budget

| Resource | Available | Used (Est.) | Remaining |
|----------|-----------|-------------|-----------|
| Flash | 4MB | ~150KB (code) | ~3.85MB |
| SRAM | 520KB | ~4KB (game data) | ~516KB |
| Heap | ~300KB (after init) | Dynamic | Variable |

**Note:** Heap usage is dynamic based on sprite loading and TFT_eSPI buffers.

## Asset Pipeline Stack

### Image Processing Workflow

```
PNG Art (Source)
     â†“
[dither_tool.py] â†’ 16-color dithering (optional)
     â†“
[resize_sprites.py] â†’ Target size (e.g., 64x64)
     â†“
[png_to_rgb565.py] â†’ RGB565 raw binary (alpha â†’ black background)
     â†“
SD Card (Runtime) OR [img2code.py] â†’ C header (compile-time)
```

### Tools Inventory

| Script | Input | Output | Purpose |
|--------|-------|--------|---------|
| `dither_tool.py` | PNG | Dithered PNG | Color reduction for CYD palette |
| `resize_sprites.py` | PNG | Resized PNG | Batch sprite sizing |
| `png_to_rgb565.py` | PNG | `.raw` (RGB565) | Runtime sprite format |
| `img2code.py` | PNG/RAW | `.h` (C array) | Compile-time sprite embedding |
| `generate_test_png.py` | N/A | Test PNG | Color validation |

## Documentation Stack

| Document | Framework | Purpose |
|----------|-----------|---------|
| Markdown | GFM (GitHub Flavored) | All `.md` docs |
| Doxygen | Planned (not implemented) | Code API documentation |
| Mermaid | Planned (not implemented) | Architecture diagrams |

## Testing Stack

| Approach | Status | Notes |
|----------|--------|-------|
| Hardware Validation | âœ… Active | Separate `hardware_test/` project |
| Wokwi Simulation | âš ï¸ Partial | Display works, SD card limited |
| Unit Tests | âŒ Not implemented | No testing framework |
| Integration Tests | Manual | On-hardware gameplay testing |

## Compiler Toolchain

| Component | Version | Purpose |
|-----------|---------|---------|
| xtensa-esp32-elf-gcc | (bundled with platform) | C/C++ compiler for ESP32 |
| Python | 3.x | PlatformIO build scripts + asset tools |
| esptool.py | (bundled) | ESP32 firmware flashing |

---

## Dependency Graph

```
Bass-Hole Project
â”œâ”€â”€ PlatformIO Core
â”‚   â”œâ”€â”€ espressif32@6.5.0 (ESP32 Arduino core)
â”‚   â”‚   â”œâ”€â”€ Arduino.h
â”‚   â”‚   â”œâ”€â”€ SPI.h
â”‚   â”‚   â””â”€â”€ SD.h
â”‚   â”œâ”€â”€ TFT_eSPI@2.5.43
â”‚   â”‚   â””â”€â”€ User_Setup.h (custom config)
â”‚   â””â”€â”€ XPT2046_Touchscreen (GitHub)
â”‚
â”œâ”€â”€ Python Asset Tools
â”‚   â”œâ”€â”€ Pillow >= 9.0.0
â”‚   â””â”€â”€ NumPy >= 1.20.0
â”‚
â””â”€â”€ Optional (Unused in current build)
    â”œâ”€â”€ managed_components (ESP-IDF)
    â”‚   â”œâ”€â”€ esp_modem
    â”‚   â”œâ”€â”€ esp-zboss-lib
    â”‚   â”œâ”€â”€ esp-zigbee-lib
    â”‚   â””â”€â”€ littlefs
    â””â”€â”€ Wokwi CLI
```

---

## Future Stack Considerations

### Audio (Planned)
- **ESP32 DAC** (built-in, no library needed)
- **ESP8266Audio** library (optional, for WAV playback)

### WiFi Features (Potential)
- **WiFiManager** (captive portal setup)
- **ArduinoOTA** (over-the-air updates)
- **MQTT** (leaderboard/multiplayer)

### Display Upgrades (Potential)
- **LovyanGFX** (faster rendering alternative to TFT_eSPI)
- **LVGL** (GUI framework for complex UIs)

---

*This stack document reflects verified configurations as of Phase 1 hardware testing.*
